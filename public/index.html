<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>News</title>

  <!-- SEO -->
  <meta name="description" content="Новости для своих — свежие сводки, фото и видео с места событий." />
  <meta name="keywords" content="новости, сводка, события, Telegram, для своих, видео, фото" />
  <meta name="author" content="Новости для своих" />

  <!-- Open Graph -->
  <meta property="og:title" content="Новости для своих" />
  <meta property="og:description" content="Сводка событий, фото и видео" />
  <meta property="og:image" content="/preview.jpg" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://example.com" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Новости для своих" />
  <meta name="twitter:description" content="Сводка событий, фото и видео" />
  <meta name="twitter:image" content="/preview.jpg" />

  <!-- Yandex.Metrika counter -->
  <script type="text/javascript">
    (function(m,e,t,r,i,k,a){
      m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
      m[i].l=1*new Date();
      k=e.createElement(t),a=e.getElementsByTagName(t)[0],
      k.async=1;k.src=r;a.parentNode.insertBefore(k,a)
    })(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(104596413, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
    });
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/104596413" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->

  <style>
    body { font-family: Arial, sans-serif; padding: 16px; }
    .post { border-bottom: 1px solid #ddd; padding: 8px 0; }

    .date { color: #666; font-size: 0.9em; }

    .post {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: zoom-in;
    }

    .post.expanded-1 {
      transform: scale(1.05);
      cursor: zoom-out;
      z-index: 5;
      position: relative;
    }

    .post.expanded-2 {
      transform: scale(1.10);
      cursor: zoom-out;
      z-index: 10;
      position: relative;
    }

    .post video,
    .post img {
      transition: transform 0.3s ease;
    }

    .post.expanded-1 video,
    .post.expanded-2 video,
    .post.expanded-1 img,
    .post.expanded-2 img {
      transform: scale(1.10);
    }
  </style>
</head>
<body>
  <h1>Новости</h1>
  <div id="news">Загрузка...</div>

  <script>
    // Отображение новостей
    function renderPosts(posts) {
      const root = document.getElementById('news');
      if (!posts || posts.length === 0) {
        root.innerHTML = '<p>Нет новостей</p>';
        return;
      }

      // Исправлено: экранирование HTML и перевод строк
      root.innerHTML = posts.map(p => {
        const text = (p.text || '')
          .replace(/</g, '&lt;')   // экранирование <
          .replace(/\n/g, '<br>'); // переносы строк

        return `<div class="post">
                  <div class="date">${new Date(p.date).toLocaleString()}</div>
                  <div class="text">${text}</div>
                </div>`;
      }).join('');

      // Анимация увеличения постов при клике
      document.querySelectorAll('.post').forEach(item => {
        item.addEventListener('click', () => {
          if (item.classList.contains('expanded-2')) {
            item.classList.remove('expanded-2');
            item.classList.remove('expanded-1');
          } else if (item.classList.contains('expanded-1')) {
            item.classList.remove('expanded-1');
            item.classList.add('expanded-2');
          } else {
            item.classList.add('expanded-1');
          }
        });
      });
    }

    // Загрузка новостей с сервера
    async function loadNews() {
      try {
        const res = await fetch('/api/news', { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const posts = await res.json();
        renderPosts(posts);
      } catch (err) {
        console.error('Ошибка загрузки новостей:', err);
        document.getElementById('news').innerText = 'Ошибка загрузки новостей';
      }
    }

    document.addEventListener('DOMContentLoaded', loadNews);
  </script>
</body>
</html>